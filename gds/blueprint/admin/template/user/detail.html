{% extends "base.html" %}
{% block precss %}
    <style type="text/css">
    </style>
{% endblock %}
{% block prejs %}
    <script src="/gds/static/js/lib/less.min.js"></script>
    <link rel="stylesheet/less" type="text/css" href="/gds/static/css/dimmer.less"/>
    <script type="text/javascript">
    </script>
{% endblock %}
{% block content %}
    <div class="ui card" style="width:500px">
        <input type="hidden" id="_id" value="{{creator['_id']}}">
        <form id="avatarform" action="" method="" enctype="multipart/form-data" >
            <input id="avatar" name="avatar" type="file" accept="" style="display:none">
     　　</form>
        <div class="ui image">
            {% if creator['current'] %}
                <div class="ui dimmer">
                    <div class="content">
                        <div class="center">
                            <input id="shadow" type="button" class="ui primary button" value="Change" class="file" onClick="avatar.click()"/>
                        </div>
                    </div>
                </div>
            {% endif %}
            <img class="ui image" src="{{creator['avatar']}}"/>
        </div>
        <div class="content">
            <a class="header">{{creator['username']}}</a>
            <div class="meta">
              <span class="date">{{creator['create_time']}}</span>
            </div>
            <div class="description">{{creator['desc']}}</div>
        </div>
        <div class="content">
            <div><i class="users icon"></i>类别：
                {% if user['group'] == 'administrator' or user['group'] == 'root' %}
                    <div id="gdrop" class="ui selection dropdown" tabindex="0">
                        <input type="hidden" id="group" value="{{creator['group']|default('', true)}}">
                        <i class="dropdown icon"></i>
                        <div class="default text">{{creator['group']}}</div>
                        <div id="gmenu" class="menu">
                            <div class="item" data-value="administrator">administrator</div>
                            <div class="item" data-value="developer">developer</div>
                            <div class="item" data-value="operator">operator</div>
                        </div>
                    </div>
                {% else %}
                    {{creator['group']}}
                {% endif %}
            </div>
            <div><i class="privacy icon"></i>密钥：{{creator['secret']}}</div>
            <div><i class="cube icon"></i>状态：
                {% if user['group'] == 'administrator' or user['group'] == 'root' %}
                    <div id="sdrop" class="ui selection dropdown" tabindex="0">
                        <input type="hidden" id="status" value="{{creator['status']|default('', true)}}">
                        <i class="dropdown icon"></i>
                        <div class="default text">{{creator['status_desc']}}</div>
                        <div id="smenu" class="menu">
                            <div class="item" data-value="0">无效</div>
                            <div class="item" data-value="1">有效</div>
                            <div class="item" data-value="2">待审核</div>
                        </div>
                    </div>
                {% else %}
                    {{creator['status_desc']}}
                {% endif %}
            </div>
            <div><i class="keyboard icon"></i><a href="/gds/a/user/password">更换密码</a></div>
        </div>
    </div>
{% endblock %}
{% block postjs %}
    <script type="text/javascript">
        {% if creator['current'] %}
            $('.ui.image').dimmer({
                on: 'hover'
              });
        {% endif %}
        $('#avatar').on('change', function(){
            var formData = new FormData($("#avatarform")[0]);
            $.ajax({
                url:'/gds/a/user/avatar',
                type:'post',
                data: formData,
                dataType:'json',
                processData: false,
                contentType: false,
                success:function(data){
                    $("img").attr('src', data.data);
                },
                error:function(XMLHttpRequest, status, thrown){
                    ;
                }
            });
        });
        $('#gdrop').dropdown({
            action:function(value, text){
                $('#group').val(text);
                $('#gdrop .default.text').text(value);
                $.ajax({
                    url:'/gds/a/user/verify',
                    type:'post',
                    data:delnull({
                        _id:$('#_id').val(),
                        value:text,
                        type:'group'
                    }),
                    async:false,
                    dataType:'json',
                    success:function(data){
                        $("#gmenu").removeClass("visible");
                        $("#gmenu").addClass("hidden");
                        $("#gdrop").removeClass("active");
                        $("#gdrop").removeClass("visible");
                    },
                    error:function(XMLHttpRequest, status, thrown){
                        ;
                    }
                });
            }
        });
        $('#sdrop').dropdown({
            action:function(value, text){
                $('#status').val(text);
                $('#sdrop .default.text').text(value);
                $.ajax({
                    url:'/gds/a/user/verify',
                    type:'post',
                    data:delnull({
                        _id:$('#_id').val(),
                        value:text,
                        type:'status'
                    }),
                    async:false,
                    dataType:'json',
                    success:function(data){
                        $("#smenu").removeClass("visible");
                        $("#smenu").addClass("hidden");
                        $("#sdrop").removeClass("active");
                        $("#sdrop").removeClass("visible");
                    },
                    error:function(XMLHttpRequest, status, thrown){
                        ;
                    }
                });
            }
        });
    </script>
{% endblock %}